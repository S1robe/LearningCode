     1                                 %line 1+1 a10procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 
    26                                 %line 66+1 a10procs.asm
    27                                 
    28                                 
    29                                 [section .data]
    30                                 
    31                                 
    32                                 
    33                                 
    34                                 TRUE equ 1
    35                                 FALSE equ 0
    36                                 
    37                                 SUCCESS equ 0
    38                                 NOSUCCESS equ 1
    39                                 
    40                                 STDIN equ 0
    41                                 STDOUT equ 1
    42                                 STDERR equ 2
    43                                 
    44                                 SYS_read equ 0
    45                                 SYS_write equ 1
    46                                 SYS_open equ 2
    47                                 SYS_close equ 3
    48                                 SYS_fork equ 57
    49                                 SYS_exit equ 60
    50                                 SYS_creat equ 85
    51                                 SYS_time equ 201
    52                                 
    53                                 LF equ 10
    54                                 SPACE equ " "
    55                                 NULL equ 0
    56                                 ESC equ 27
    57                                 
    58                                 
    59                                 
    60                                 
    61                                 GL_COLOR_BUFFER_BIT equ 16384
    62                                 GL_POINTS equ 0
    63                                 GL_POLYGON equ 9
    64                                 GL_PROJECTION equ 5889
    65                                 
    66                                 GLUT_RGB equ 0
    67                                 GLUT_SINGLE equ 0
    68                                 
    69                                 
    70                                 
    71                                 
    72                                 SPD_MIN equ 1
    73                                 SPD_MAX equ 50
    74                                 
    75                                 CLR_MIN equ 0
    76                                 CLR_MAX equ 0xFFFFFF
    77                                 
    78                                 SIZ_MIN equ 100
    79                                 SIZ_MAX equ 2000
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 STR_LENGTH equ 12
    85                                 
    86 00000000 55736167653A202E2F-    errUsage db "Usage: ./wheels -sp <septNumber> -cl <septNumber> "
    87 00000000 776865656C73202D73-
    88 00000000 70203C736570744E75-
    89 00000000 6D6265723E202D636C-
    90 00000000 203C736570744E756D-
    91 00000000 6265723E20         
    92 00000032 2D737A203C73657074-     db "-sz <septNumber>"
    93 00000032 4E756D6265723E     
    94 00000042 0A00                    db LF, NULL
    95 00000044 4572726F722C20696E-    errBadCL db "Error, invalid or incomplete command line argument."
    96 00000044 76616C6964206F7220-
    97 00000044 696E636F6D706C6574-
    98 00000044 6520636F6D6D616E64-
    99 00000044 206C696E6520617267-
   100 00000044 756D656E742E       
   101 00000077 0A00                    db LF, NULL
   102                                 
   103 00000079 4572726F722C207370-    errSpdSpec db "Error, speed specifier incorrect."
   104 00000079 656564207370656369-
   105 00000079 6669657220696E636F-
   106 00000079 72726563742E       
   107 0000009A 0A00                    db LF, NULL
   108 0000009C 4572726F722C207370-    errSpdValue db "Error, speed value must be between 1 and 101(7)."
   109 0000009C 6565642076616C7565-
   110 0000009C 206D75737420626520-
   111 0000009C 6265747765656E2031-
   112 0000009C 20616E642031303128-
   113 0000009C 37292E             
   114 000000CC 0A00                    db LF, NULL
   115                                 
   116 000000CE 4572726F722C20636F-    errClrSpec db "Error, color specifier incorrect."
   117 000000CE 6C6F72207370656369-
   118 000000CE 6669657220696E636F-
   119 000000CE 72726563742E       
   120 000000EF 0A00                    db LF, NULL
   121 000000F1 4572726F722C20636F-    errClrValue db "Error, color value must be between 0 and 262414110(7)."
   122 000000F1 6C6F722076616C7565-
   123 000000F1 206D75737420626520-
   124 000000F1 6265747765656E2030-
   125 000000F1 20616E642032363234-
   126 000000F1 31343131302837292E 
   127 00000127 0A00                    db LF, NULL
   128                                 
   129 00000129 4572726F722C207369-    errSizSpec db "Error, size specifier incorrect."
   130 00000129 7A6520737065636966-
   131 00000129 69657220696E636F72-
   132 00000129 726563742E         
   133 00000149 0A00                    db LF, NULL
   134 0000014B 4572726F722C207369-    errSizValue db "Error, size value must be between 202(7) and 5555(7)."
   135 0000014B 7A652076616C756520-
   136 0000014B 6D7573742062652062-
   137 0000014B 65747765656E203230-
   138 0000014B 3228372920616E6420-
   139 0000014B 353535352837292E   
   140 00000180 0A00                    db LF, NULL
   141                                 
   142                                 
   143                                 
   144                                 
   145 00000182 0000000000000000       t dq 0.0
   146 0000018A 0000000000000000       s dq 0.0
   147 00000192 FCA9F1D24D62503F       tStep dq 0.001
   148 0000019A 0000000000000000       sStep dq 0.0
   149 000001A2 0000000000000000       x dq 0
   150 000001AA 0000000000000000       y dq 0
   151 000001B2 00000000004CBD40       scale dq 7500.0
   152                                 
   153 000001BA 0000000000000000       fltZero dq 0.0
   154 000001C2 000000000000F03F       fltOne dq 1.0
   155 000001CA 0000000000000040       fltTwo dq 2.0
   156 000001D2 0000000000000840       fltThree dq 3.0
   157 000001DA 0000000000001040       fltFour dq 4.0
   158 000001E2 0000000000001840       fltSix dq 6.0
   159 000001EA 0000000000000000       fltTwoPiS dq 0.0
   160                                 
   161 000001F2 F4D64354FB210940       pi dq 3.14159265358
   162                                 
   163 000001FA 0000000000000000       fltTmp1 dq 0.0
   164 00000202 0000000000000000       fltTmp2 dq 0.0
   165                                 
   166 0000020A 00000000               red dd 0
   167 0000020E 00000000               green dd 0
   168 00000212 00000000               blue dd 0
   169                                 
   170                                 
   171                                 
   172                                 
   173                                 [section .text]
   174                                 
   175                                 
   176                                 
   177                                 
   178                                 [extern glutInit]
   179                                 %line 182+0 a10procs.asm
   180                                 [extern glutInitDisplayMode]
   181                                 [extern glutInitWindowSize]
   182                                 [extern glutInitWindowPosition]
   183                                 %line 183+1 a10procs.asm
   184                                 [extern glutCreateWindow]
   185                                 %line 183+0 a10procs.asm
   186                                 [extern glutMainLoop]
   187                                 %line 184+1 a10procs.asm
   188                                 [extern glutDisplayFunc]
   189                                 %line 184+0 a10procs.asm
   190                                 [extern glutIdleFunc]
   191                                 [extern glutReshapeFunc]
   192                                 [extern glutKeyboardFunc]
   193                                 %line 185+1 a10procs.asm
   194                                 [extern glutSwapBuffers]
   195                                 %line 185+0 a10procs.asm
   196                                 [extern gluPerspective]
   197                                 [extern glutPostRedisplay]
   198                                 %line 186+1 a10procs.asm
   199                                 [extern glClearColor]
   200                                 %line 186+0 a10procs.asm
   201                                 [extern glClearDepth]
   202                                 [extern glDepthFunc]
   203                                 [extern glEnable]
   204                                 [extern glShadeModel]
   205                                 %line 187+1 a10procs.asm
   206                                 [extern glClear]
   207                                 %line 187+0 a10procs.asm
   208                                 [extern glLoadIdentity]
   209                                 [extern glMatrixMode]
   210                                 [extern glViewport]
   211                                 %line 188+1 a10procs.asm
   212                                 [extern glTranslatef]
   213                                 %line 188+0 a10procs.asm
   214                                 [extern glRotatef]
   215                                 [extern glBegin]
   216                                 [extern glEnd]
   217                                 [extern glVertex3f]
   218                                 [extern glColor3f]
   219                                 %line 189+1 a10procs.asm
   220                                 [extern glVertex2f]
   221                                 %line 189+0 a10procs.asm
   222                                 [extern glVertex2i]
   223                                 [extern glColor3ub]
   224                                 [extern glOrtho]
   225                                 [extern glFlush]
   226                                 [extern glVertex2d]
   227                                 %line 190+1 a10procs.asm
   228                                 
   229                                 [extern cos]
   230                                 %line 191+0 a10procs.asm
   231                                 [extern sin]
   232                                 %line 192+1 a10procs.asm
   233                                 
   234                                 
   235                                 
   236                                 
   237                                 
   238                                 
   239                                 
   240                                 
   241                                 
   242                                 
   243                                 
   244                                 
   245                                 
   246                                 
   247                                 
   248                                 
   249                                 
   250                                 
   251                                 
   252                                 
   253                                 
   254                                 
   255                                 
   256                                 
   257                                 [global getParams]
   258                                 getParams:
   259                                 
   260                                 
   261                                 
   262                                 
   263                                 
   264                                 
   265 00000000 48C7C0[00000000]       mov rax, errUsage
   266 00000007 4883FF01               cmp rdi, 1
   267 0000000B 0F8458020000           je fail
   268                                 
   269 00000011 48C7C0[00000000]       mov rax, errBadCL
   270 00000018 4883FF07               cmp rdi, 7
   271 0000001C 0F8547020000           jne fail
   272                                 
   273 00000022 4C8D0CFE               lea r9, [rsi + (rdi)*8]
   274 00000026 4883C608               add rsi, 8
   275 0000002A 48C7C701000000         mov rdi, 1
   276                                 chompInput:
   277 00000031 4C39CE                  cmp rsi, r9
   278 00000034 0F842F020000            je dneChomp
   279 0000003A 4989F2                  mov r10, rsi
   280 0000003D 4983C208                add r10, 8
   281 00000041 4151                    push r9
   282                                 
   283                                 
   284                                 
   285 00000043 803E2D                  cmp byte[rsi], '-'
   286 00000046 7565                    jne failNoTac
   287 00000048 48FFC6                  inc rsi
   288                                 
   289 0000004B 803E73                  cmp byte[rsi], 's'
   290 0000004E 7426                    je checkSpSz
   291                                 
   292 00000050 803E63                  cmp byte[rsi], 'c'
   293 00000053 0F8510020000            jne fail
   294 00000059 48FFC6                  inc rsi
   295                                 
   296 0000005C 803E6C                  cmp byte[rsi], 'l'
   297 0000005F 0F8504020000            jne fail
   298                                 
   299                                 
   300 00000065 48C7C0[00000000]        mov rax, errClrSpec
   301 0000006C 4883FF02                cmp rdi, 2
   302 00000070 0F85F3010000            jne fail
   303 00000076 EB65                    jmp validate
   304                                 
   305                                  checkSpSz:
   306 00000078 48FFC6                  inc rsi
   307 0000007B 803E70                  cmp byte[rsi], 'p'
   308 0000007E 7511                    jne checkZ
   309                                 
   310                                 
   311 00000080 48C7C0[00000000]        mov rax, errSpdSpec
   312 00000087 4883FF01                cmp rdi, 1
   313 0000008B 0F85D8010000            jne fail
   314 00000091 EB4A                    jmp validate
   315                                 
   316                                  checkZ:
   317 00000093 803E7A                  cmp byte[rsi], 'z'
   318 00000096 0F85CD010000            jne fail
   319                                 
   320                                 
   321 0000009C 48C7C0[00000000]        mov rax, errSizSpec
   322 000000A3 4883FF03                cmp rdi, 3
   323 000000A7 0F85BC010000            jne fail
   324 000000AD EB2E                    jmp validate
   325                                 
   326                                  failNoTac:
   327 000000AF 4883FF01                cmp rdi, 1
   328 000000B3 7410                    je failSP
   329 000000B5 4883FF02                cmp rdi, 2
   330 000000B9 7416                    je failCL
   331                                 
   332                                 
   333 000000BB 48C7C0[00000000]        mov rax, errSizSpec
   334 000000C2 E9A3010000              jmp fail
   335                                 
   336                                  failSP:
   337 000000C7 48C7C0[00000000]        mov rax, errSpdSpec
   338 000000CE E997010000              jmp fail
   339                                 
   340                                  failCL:
   341 000000D3 48C7C0[00000000]        mov rax, errClrSpec
   342 000000DA E98B010000              jmp fail
   343                                 
   344                                  validate:
   345 000000DF 48FFC6                  inc rsi
   346 000000E2 803E00                  cmp byte[rsi], 0
   347 000000E5 75C6                    jne failNoTac
   348                                 
   349                                  chompVal:
   350 000000E7 4883FF01                cmp rdi, 1
   351 000000EB 0F848E000000            je chompSpd
   352                                 
   353 000000F1 4883FF02                cmp rdi, 2
   354 000000F5 0F84FC000000            je chompClr
   355                                 
   356                                 
   357 000000FB 48C7C0[00000000]        mov rax, errSizValue
   358 00000102 48C7C000000000         mov rax, 0
   359                                 %line 317+0 a10procs.asm
   360 00000109 49C7C007000000         mov r8, 7
   361                                 ..@12.loop:
   362 00000110 458A0A                  mov r9b, byte[r10]
   363 00000113 4180E930                sub r9b, 48
   364 00000117 4180F900                cmp r9b, 0
   365 0000011B 7C15                    jl ..@12.fail
   366 0000011D 4180F907                cmp r9b, 7
   367 00000121 7D0F                    jge ..@12.fail
   368                                 
   369 00000123 41F7E0                  mul r8d
   370 00000126 4C01C8                  add rax, r9
   371 00000129 49FFC2                  inc r10
   372 0000012C 41803A00                cmp byte[r10], 0
   373 00000130 7430                    je ..@12.done
   374 00000132 EBDA                    jmp ..@12.loop
   375                                 
   376                                 
   377                                 
   378                                 ..@12.fail:
   379 00000134 4883FF01                cmp rdi, 1
   380 00000138 7410                    je ..@12.failValueSpd
   381 0000013A 4883FF02                cmp rdi, 2
   382 0000013E 7416                    je ..@12.failValueClr
   383                                 
   384                                 
   385 00000140 48C7C0[00000000]        mov rax, errSizValue
   386 00000147 E91E010000              jmp fail
   387                                 
   388                                  ..@12.failValueSpd:
   389 0000014C 48C7C0[00000000]        mov rax, errSpdValue
   390 00000153 E912010000              jmp fail
   391                                 
   392                                  ..@12.failValueClr:
   393 00000158 48C7C0[00000000]        mov rax, errClrValue
   394 0000015F E906010000              jmp fail
   395                                 
   396                                 ..@12.done:
   397 00000164 4189C3                  mov r11d, eax
   398                                 %line 318+1 a10procs.asm
   399 00000167 4181FBD0070000          cmp r11d, SIZ_MAX
   400 0000016E 0F8FF5000000            jg fail
   401 00000174 4183FB64                cmp r11d, SIZ_MIN
   402 00000178 0F8CEB000000            jl fail
   403 0000017E 4159                    pop r9
   404 00000180 E9A7FEFFFF              jmp chompInput
   405                                 
   406                                  chompSpd:
   407 00000185 48C7C000000000         mov rax, 0
   408                                 %line 326+0 a10procs.asm
   409 0000018C 49C7C007000000         mov r8, 7
   410                                 ..@13.loop:
   411 00000193 458A0A                  mov r9b, byte[r10]
   412 00000196 4180E930                sub r9b, 48
   413 0000019A 4180F900                cmp r9b, 0
   414 0000019E 7C15                    jl ..@13.fail
   415 000001A0 4180F907                cmp r9b, 7
   416 000001A4 7D0F                    jge ..@13.fail
   417                                 
   418 000001A6 41F7E0                  mul r8d
   419 000001A9 4C01C8                  add rax, r9
   420 000001AC 49FFC2                  inc r10
   421 000001AF 41803A00                cmp byte[r10], 0
   422 000001B3 7430                    je ..@13.done
   423 000001B5 EBDA                    jmp ..@13.loop
   424                                 
   425                                 
   426                                 
   427                                 ..@13.fail:
   428 000001B7 4883FF01                cmp rdi, 1
   429 000001BB 7410                    je ..@13.failValueSpd
   430 000001BD 4883FF02                cmp rdi, 2
   431 000001C1 7416                    je ..@13.failValueClr
   432                                 
   433                                 
   434 000001C3 48C7C0[00000000]        mov rax, errSizValue
   435 000001CA E99B000000              jmp fail
   436                                 
   437                                  ..@13.failValueSpd:
   438 000001CF 48C7C0[00000000]        mov rax, errSpdValue
   439 000001D6 E98F000000              jmp fail
   440                                 
   441                                  ..@13.failValueClr:
   442 000001DB 48C7C0[00000000]        mov rax, errClrValue
   443 000001E2 E983000000              jmp fail
   444                                 
   445                                 ..@13.done:
   446 000001E7 4189C3                  mov r11d, eax
   447                                 %line 327+1 a10procs.asm
   448 000001EA 4183FB32                cmp r11d, SPD_MAX
   449 000001EE 7F7D                    jg fail
   450 000001F0 4183FB01                cmp r11d, SPD_MIN
   451 000001F4 7C77                    jl fail
   452 000001F6 4159                    pop r9
   453 000001F8 E92FFEFFFF              jmp chompInput
   454                                 
   455                                  chompClr:
   456 000001FD 48C7C000000000         mov rax, 0
   457                                 %line 335+0 a10procs.asm
   458 00000204 49C7C007000000         mov r8, 7
   459                                 ..@14.loop:
   460 0000020B 458A0A                  mov r9b, byte[r10]
   461 0000020E 4180E930                sub r9b, 48
   462 00000212 4180F900                cmp r9b, 0
   463 00000216 7C15                    jl ..@14.fail
   464 00000218 4180F907                cmp r9b, 7
   465 0000021C 7D0F                    jge ..@14.fail
   466                                 
   467 0000021E 41F7E0                  mul r8d
   468 00000221 4C01C8                  add rax, r9
   469 00000224 49FFC2                  inc r10
   470 00000227 41803A00                cmp byte[r10], 0
   471 0000022B 7427                    je ..@14.done
   472 0000022D EBDA                    jmp ..@14.loop
   473                                 
   474                                 
   475                                 
   476                                 ..@14.fail:
   477 0000022F 4883FF01                cmp rdi, 1
   478 00000233 740D                    je ..@14.failValueSpd
   479 00000235 4883FF02                cmp rdi, 2
   480 00000239 7410                    je ..@14.failValueClr
   481                                 
   482                                 
   483 0000023B 48C7C0[00000000]        mov rax, errSizValue
   484 00000242 EB29                    jmp fail
   485                                 
   486                                  ..@14.failValueSpd:
   487 00000244 48C7C0[00000000]        mov rax, errSpdValue
   488 0000024B EB20                    jmp fail
   489                                 
   490                                  ..@14.failValueClr:
   491 0000024D 48C7C0[00000000]        mov rax, errClrValue
   492 00000254 EB17                    jmp fail
   493                                 
   494                                 ..@14.done:
   495 00000256 4189C3                  mov r11d, eax
   496                                 %line 336+1 a10procs.asm
   497 00000259 4181FBFFFFFF00          cmp r11d, CLR_MAX
   498 00000260 7F0B                    jg fail
   499 00000262 4183FB00                cmp r11d, CLR_MIN
   500 00000266 7C05                    jl fail
   501 00000268 4159                    pop r9
   502 0000026A E9BDFDFFFF              jmp chompInput
   503                                 
   504                                 dneChomp:
   505                                 
   506                                 
   507                                 
   508                                 
   509                                 
   510                                 fail:
   511 0000026F 4889C7                  mov rdi, rax
   512 00000272 E872000000              call printString
   513 00000277 48C7C000000000          mov rax, FALSE
   514                                 
   515 0000027E C3                      ret
   516                                 
   517                                 
   518                                 
   519                                 
   520                                 
   521                                 
   522                                 
   523                                 
   524                                 
   525                                 
   526                                 
   527                                 
   528                                 
   529                                 
   530                                 [common speed 1:4]
   531                                 [common color 1:4]
   532                                 [common size 1:4]
   533                                 
   534                                 [global drawWheels]
   535                                 drawWheels:
   536 0000027F 55                      push rbp
   537                                 
   538                                 
   539                                 
   540                                 
   541                                 
   542                                 
   543                                 
   544                                 
   545                                 
   546                                 
   547                                 
   548                                 
   549                                 
   550 00000280 48C7C700400000          mov rdi, GL_COLOR_BUFFER_BIT
   551 00000287 E8(F6FFFFFF)            call glClear
   552                                 
   553                                 
   554 0000028C 48C7C700000000          mov rdi, GL_POINTS
   555 00000293 E8(F6FFFFFF)            call glBegin
   556                                 
   557                                 
   558                                 
   559                                 
   560                                 
   561                                 
   562                                 
   563                                 
   564                                 
   565                                 
   566                                 
   567                                 
   568                                 
   569                                 
   570                                 
   571                                 
   572                                 
   573                                 
   574                                 
   575 00000298 E8(F6FFFFFF)            call glEnd
   576 0000029D E8(F6FFFFFF)            call glFlush
   577                                 
   578                                 
   579                                 
   580                                 
   581                                 
   582                                 
   583 000002A2 F20F100425[00000000]      movsd xmm0, qword [s]
   584 000002AB F20F580425[00000000]      addsd xmm0, qword [sStep]
   585 000002B4 F20F110425[00000000]      movsd qword [s], xmm0
   586                                 
   587 000002BD F20F100425[00000000]      movsd xmm0, qword [s]
   588 000002C6 F20F100C25[00000000]      movsd xmm1, qword [fltOne]
   589 000002CF 660F2EC1                ucomisd xmm0, xmm1
   590 000002D3 7610                    jbe resetDone
   591                                 
   592 000002D5 F20F100425[00000000]      movsd xmm0, qword [fltZero]
   593 000002DE F20F110425[00000000]      movsd qword [sStep], xmm0
   594                                 resetDone:
   595                                 
   596 000002E7 E8(F6FFFFFF)            call glutPostRedisplay
   597                                 
   598                                 
   599                                 
   600 000002EC 5D                      pop rbp
   601 000002ED C3                      ret
   602                                 
   603                                 
   604                                 
   605                                 
   606                                 
   607                                 
   608                                 
   609                                 
   610                                 
   611                                 
   612                                 
   613                                 
   614                                 
   615                                 [global printString]
   616                                 printString:
   617 000002EE 53                      push rbx
   618                                 
   619                                 
   620                                 
   621                                 
   622 000002EF 4889FB                  mov rbx, rdi
   623 000002F2 48C7C200000000          mov rdx, 0
   624                                 strCountLoop:
   625 000002F9 803B00                  cmp byte [rbx], NULL
   626 000002FC 7406                    je strCountDone
   627 000002FE 48FFC3                  inc rbx
   628 00000301 48FFC2                  inc rdx
   629 00000304 EBF1                    jmp strCountLoop
   630                                 strCountDone:
   631                                 
   632 00000306 4883FA00                cmp rdx, 0
   633 0000030A 7411                    je prtDone
   634                                 
   635                                 
   636                                 
   637                                 
   638 0000030C 48C7C001000000          mov rax, SYS_write
   639 00000313 4889FE                  mov rsi, rdi
   640 00000316 48C7C701000000          mov rdi, STDOUT
   641                                 
   642 0000031D 0F05                    syscall
   643                                 
   644                                 
   645                                 
   646                                 
   647                                 prtDone:
   648 0000031F 5B                      pop rbx
   649 00000320 C3                      ret
   650                                 
   651                                 
   652                                 
